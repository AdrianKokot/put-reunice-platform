<div class='w-full d-flex gap-4 tui-space_bottom-4' [formGroup]='filtersForm'>
  <label class='w-full'>
    <tui-input
      formControlName='search'
      [tuiTextfieldLabelOutside]='true'
      class='no-shadow'
      tuiTextfieldSize='m'
      [tuiTextfieldCleaner]='true'
    >
      {{ 'SEARCH' | translate }}
      <input tuiTextfield type='text' />
    </tui-input>
  </label>

  <button
    tuiIconButton
    [tuiHint]="'CLEAR_FILTERS' | translate"
    [icon]="'tuiIconXCircle'"
    appearance='outline'
    (click)='filtersForm.reset()'
    *ngIf='((filtersForm | notEmptyValues | async) ?? 0) > 0'
  ></button>
</div>

<tui-scrollbar class='reunice-table-wrapper'>
  <table
    tuiTable
    tuiSortBy
    [columns]='columns'
    *tuiLet='items$ | async as items'
  >
    <thead [formGroup]='filtersForm'>
    <tr tuiThGroup>
      <th
        *tuiHead="'title'"
        tuiTh
        tuiSortable
        [sticky]='true'
        class='column-rest'
      >
        {{ 'TITLE' | translate }}
      </th>

      <th
        *tuiHead="'requestedTime'"
        tuiTh
        tuiSortable
        [sticky]='true'
        class='column-sm'
      >
        {{ 'CREATED_ON' | translate }}
      </th>

      <th
        *tuiHead="'requesterEmail'"
        tuiTh
        tuiSortable
        [sticky]='true'
        class='column-md'
      >
        {{ 'REQUESTER_EMAIL' | translate }}
      </th>

      <th
        *tuiHead="'status'"
        tuiTh
        tuiSortable
        [sticky]='true'
        class='column-sm'
      >
        {{ 'TICKET_STATUS' | translate }}

        <reunice-table-filter formControlName='status_eq'>
          <tui-data-list *tuiDataList size='s'>
            <button tuiOption value='new'>
              {{ 'TICKET_STATUS_NEW' | translate }}
            </button>
          </tui-data-list>
        </reunice-table-filter>
      </th>

      <th
        *tuiHead="'actions'"
        tuiTh
        [sorter]='null'
        [sticky]='true'
        class='column-actions'
      ></th>
    </tr>
    </thead>

    <tbody tuiTbody>
    <tr
      *ngFor='
          let item of items;
          else: loadingList;
          empty: emptyList;
          trackById
        '
      tuiTr
    >
      <td *tuiCell="'title'" tuiTd
          class='column-rest'>
        {{ item.title }}
      </td>

      <td *tuiCell="'requestedTime'" tuiTd
          class='column-sm'>
        {{ item.requestedTime | localizedDate }}
      </td>

      <td *tuiCell="'requesterEmail'" tuiTd
          class='column-md'>
        {{ item.requesterEmail }}
      </td>

      <td *tuiCell="'status'" tuiTd
          class='column-sm'>
        <tui-badge
          [status]="item | ticketToBadgeStatus"
          [value]="('TICKET_STATUS_' + item.status) | translate"
        ></tui-badge>
      </td>

      <td class='column-actions' *tuiCell="'actions'" tuiTd>
        <a
          [routerLink]='[item.id]'
          tuiIconButton
          size='s'
          appearance='flat'
          [icon]="'tuiIconExternalLink'"
          shape='rounded'
          [tuiHint]="'SEE_TICKET' | translate"
        >
        </a>
      </td>
    </tr>
    </tbody>
  </table>
</tui-scrollbar>

<tui-table-pagination
  class='tui-space_top-2'
  [total]='(total$ | async) ?? 0'
></tui-table-pagination>

<ng-template #emptyList>
  <tr>
    <td tuiTd class='t-empty' [colSpan]='columns.length'>
      {{ emptyMessage$ | async }}
    </td>
  </tr>
</ng-template>

<ng-template #loadingList>
  <tr>
    <td [colSpan]='columns.length'>
      <tui-loader></tui-loader>
    </td>
  </tr>
</ng-template>
